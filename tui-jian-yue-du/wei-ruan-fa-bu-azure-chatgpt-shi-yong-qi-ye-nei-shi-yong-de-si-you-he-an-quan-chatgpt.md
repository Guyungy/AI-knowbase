# å¾®è½¯å‘å¸ƒAzure ChatGPTï¼šé€‚ç”¨ä¼ä¸šå†…ä½¿ç”¨çš„ç§æœ‰å’Œå®‰å…¨ ChatGPT

### ä¼˜åŠ¿

1. ç§å¯†æ€§ï¼šå†…ç½®çš„éšç§ä¿éšœï¼Œå®Œå…¨ä¸OpenAIè¿è¥çš„ä¿æŒéš”ç¦»ã€‚
2. å¯æ§æ€§ï¼šç½‘ç»œæµé‡å¯ä»¥å®Œå…¨éš”ç¦»åˆ°æ‚¨çš„ç½‘ç»œä¸­ï¼Œå¹¶ä¸”è¿˜å†…ç½®äº†å…¶ä»–ä¼ä¸šçº§å®‰å…¨æ§åˆ¶ã€‚
3. ä»·å€¼ï¼šé€šè¿‡æ‚¨è‡ªå·±çš„å†…éƒ¨æ•°æ®æºï¼ˆå³æ’å³ç”¨ï¼‰æˆ–ä½¿ç”¨æ’ä»¶ä¸æ‚¨çš„å†…éƒ¨æœåŠ¡é›†æˆï¼ˆä¾‹å¦‚ï¼ŒServiceNowç­‰ï¼‰ï¼Œå¢åŠ ä¸šåŠ¡ä»·å€¼ã€‚ æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåŠ é€Ÿå™¨ï¼Œä»¥èµ‹èƒ½æ‚¨çš„å·¥ä½œäººå‘˜ä½¿ç”¨Azure ChatGPTã€‚

### ğŸ“˜å…ˆå†³æ¡ä»¶

[**Azure OpenAI**](https://azure.microsoft.com/en-us/products/cognitive-services/openai-service/)

1. è¦åœ¨Azureä¸Šéƒ¨ç½²å’Œè¿è¡ŒChatGPTï¼Œæ‚¨éœ€è¦ä¸€ä¸ªå…·æœ‰è®¿é—®Azure OpenAIæœåŠ¡çš„Azureè®¢é˜…ã€‚åœ¨[**æ­¤å¤„**](https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso\_Pz4b1\_xUOFA5Qk1UWDRBMjg0WFhPMkIzTzhKQ1dWNyQlQCN0PWcu)è¯·æ±‚è®¿é—®æƒé™ã€‚ä¸€æ—¦è·å¾—è®¿é—®æƒé™ï¼Œè¯·æŒ‰ç…§æ­¤é“¾æ¥ä¸­çš„è¯´æ˜éƒ¨ç½²gpt-35-turboæˆ–gpt-4æ¨¡å‹ã€‚
2. è®¾ç½®GitHubæˆ–Azure ADè¿›è¡Œèº«ä»½éªŒè¯ï¼šä¸‹é¢[**æ·»åŠ èº«ä»½æä¾›è€…**](https://github.com/oliverlabs/azurechatgpt#-add-an-identity-provider)éƒ¨åˆ†å±•ç¤ºäº†å¦‚ä½•é…ç½®èº«ä»½éªŒè¯æä¾›è€…ã€‚> ğŸ’¡æ³¨æ„ï¼šæ‚¨å¯ä»¥ä½¿ç”¨[**NextAuth**](https://next-auth.js.org/providers/)æä¾›è€…å°†èº«ä»½è§£å†³æ–¹æ¡ˆé…ç½®ä¸ºèº«ä»½éªŒè¯æä¾›è€…ã€‚

### ğŸ‘‹ğŸ» ä»‹ç»

* Azure ChatGPT æ˜¯ä½¿ç”¨ä¸‹è¿°æŠ€æœ¯æ„å»ºçš„ã€‚
* Node.js 18ï¼šä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚
* Next.js 13ï¼šé€šè¿‡æ‰©å±•æœ€æ–°çš„ React ç‰¹æ€§ï¼Œä½¿æ‚¨èƒ½å¤Ÿåˆ›å»ºå…¨æ ˆ web åº”ç”¨ç¨‹åºã€‚
* NextAuth.jsï¼šNext.js 13 çš„å¯é…ç½®èº«ä»½éªŒè¯æ¡†æ¶ã€‚
* LangChain JSï¼šç”¨äºæ„å»ºæ™ºèƒ½åº”ç”¨ç¨‹åºçš„ AI ç¼–æ’å±‚ã€‚
* Tailwind CSSï¼šæ˜¯ä¸€ä¸ªå®ç”¨ä¸ºå…ˆçš„ CSS æ¡†æ¶ï¼Œæä¾›ä¸€ç³»åˆ—é¢„å®šä¹‰çš„ç±»ï¼Œå¯ä»¥ç”¨æ¥æ··åˆåŒ¹é…æ¯ä¸ªå…ƒç´ çš„æ ·å¼ã€‚
* shadcn/uiï¼šä½¿ç”¨ Radix UI å’Œ Tailwind CSS æ„å»ºçš„å¯é‡å¤ä½¿ç”¨ç»„ä»¶ã€‚
* Azure Cosmos DBï¼šå®Œå…¨æ‰˜ç®¡çš„å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰NoSQL æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨èŠå¤©è®°å½•ã€‚
* Azure App Serviceï¼šå®Œå…¨æ‰˜ç®¡çš„å¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰ï¼Œç”¨äºæ‰˜ç®¡ web åº”ç”¨ç¨‹åºã€REST API å’Œç§»åŠ¨åç«¯ã€‚!\[ä¸‹è½½å¤±è´¥]\(./å¾®è½¯å‘å¸ƒAzure ChatGPTï¼šé€‚ç”¨ä¼ä¸šå†…ä½¿ç”¨çš„ç§æœ‰å’Œå®‰å…¨ ChatGPT.assert/architecture.png)

### ğŸ’™ ä¸€é”®éƒ¨ç½² Azure

[**éƒ¨ç½²**](https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fthivy%2Fazure-chatgpt%2Fmain%2Finfra%2Fmain.json) ç‚¹å‡»â€œéƒ¨ç½²åˆ° Azureâ€æŒ‰é’®ï¼Œå¹¶æ ¹æ®[**ç¯å¢ƒå˜é‡**](https://github.com/microsoft/azurechatgpt#%F0%9F%94%91-environment-variables)éƒ¨åˆ†åœ¨ Azure é—¨æˆ·ä¸­é…ç½®æ‚¨çš„è®¾ç½®ã€‚ æœ‰å…³å°†èº«ä»½éªŒè¯æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºçš„é‡è¦ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸‹é¢çš„éƒ¨åˆ†ã€‚ â€‹

### ğŸ‘¨ğŸ»â€ğŸ’» ä»æœ¬åœ°æœºå™¨è¿è¡Œ

åœ¨æœ¬åœ°å…‹éš†è¯¥å­˜å‚¨åº“æˆ–è€…å¤åˆ¶åˆ°æ‚¨çš„Githubè´¦æˆ·ã€‚ä»â€œsrcâ€ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹æ‰€æœ‰æ­¥éª¤ã€‚

1. ç¡®ä¿åœ¨æ‚¨çš„Azureè®¢é˜…ä¸­éƒ¨ç½²äº†ä¸€ä¸ªCosmos DBå®ä¾‹ã€‚
2. åˆ›å»ºä¸€ä¸ªåä¸º.env.localçš„æ–°æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨ç¯å¢ƒå˜é‡ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å˜é‡ã€‚ **è¯·æ³¨æ„ï¼š** ä¸è¦ä½¿ç”¨åŒå¼•å·ï¼Œå¹¶ä¸”ä¸è¦åˆ é™¤ä»»ä½•å˜é‡ã€‚ ç¡®ä¿NEXTAUTH\_URL=[http://localhost:3000](http://localhost:3000) è¿™ä¸€è¡Œæ²¡æœ‰æ³¨é‡Šã€‚

```json
# Azure OpenAI configuration
AZURE_OPENAI_API_KEY=
AZURE_OPENAI_API_INSTANCE_NAME=
AZURE_OPENAI_API_DEPLOYMENT_NAME=
AZURE_OPENAI_API_VERSION=

# GitHub OAuth app configuration
AUTH_GITHUB_ID=
AUTH_GITHUB_SECRET=

# Azure AD OAuth app configuration
AZURE_AD_CLIENT_ID=
AZURE_AD_CLIENT_SECRET=
AZURE_AD_TENANT_ID=

# When deploying to production,
# set the NEXTAUTH_URL environment variable to the canonical URL of your site.
# More information: https://next-auth.js.org/configuration/options

NEXTAUTH_SECRET=
NEXTAUTH_URL=http://localhost:3000

AZURE_COSMOSDB_URI=
AZURE_COSMOSDB_KEY=
```

1. å°†å½“å‰æ´»åŠ¨ç›®å½•æ›´æ”¹ä¸ºsrc
2. é€šè¿‡è¿è¡Œnpm installå®‰è£…npmåŒ…
3. é€šè¿‡è¿è¡Œnpm run devå¯åŠ¨é¡¹ç›®
4. ç°åœ¨ä½ åº”è¯¥ä¼šè¢«æç¤ºç™»å½•ä½ é€‰æ‹©çš„OAuthæä¾›è€…ã€‚ç™»å½•æˆåŠŸåï¼Œä½ å¯ä»¥å¼€å§‹åˆ›å»ºæ–°çš„å¯¹è¯ã€‚â€‹ !\[ä¸‹è½½å¤±è´¥]\(./å¾®è½¯å‘å¸ƒAzure ChatGPTï¼šé€‚ç”¨ä¼ä¸šå†…ä½¿ç”¨çš„ç§æœ‰å’Œå®‰å…¨ ChatGPT.assert/chat-home.png)

!\[ä¸‹è½½å¤±è´¥]\(./å¾®è½¯å‘å¸ƒAzure ChatGPTï¼šé€‚ç”¨ä¼ä¸šå†…ä½¿ç”¨çš„ç§æœ‰å’Œå®‰å…¨ ChatGPT.assert/chat-history.png)

### â˜ï¸ éƒ¨ç½²åˆ° Azure - GitHub Actions

#### ğŸ§¬ Fork è¯¥å­˜å‚¨åº“

[**ç‚¹æ­¤å¼€å§‹Fork**](https://github.com/microsoft/azurechatgpt/fork) å°†è¯¥å­˜å‚¨åº“forkåˆ°æ‚¨è‡ªå·±çš„ç»„ç»‡ä¸­ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥é’ˆå¯¹è‡ªå·±çš„Azureè®¢é˜…æ‰§è¡ŒGitHub Actionsã€‚ â€‹

#### ğŸ—ï¸ åœ¨æ‚¨çš„GitHubå­˜å‚¨åº“ä¸­é…ç½®

1. AZURE\_CREDENTIALSGitHubå·¥ä½œæµç¨‹éœ€è¦ä¸€ä¸ªåä¸ºAZURE\_CREDENTIALSçš„æœºå¯†æ¥å¯¹Azureè¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¥æœºå¯†åŒ…å«åœ¨åŒ…å«å®¹å™¨åº”ç”¨ç¨‹åºå’Œå®¹å™¨æ³¨å†Œè¡¨çš„èµ„æºç»„ä¸Šå…·æœ‰Contributorè§’è‰²çš„æœåŠ¡ä¸»ä½“çš„å‡­æ®ã€‚
2. åœ¨åŒ…å«Azureåº”ç”¨æœåŠ¡çš„èµ„æºç»„ä¸Šåˆ›å»ºå…·æœ‰Contributorè§’è‰²çš„æœåŠ¡ä¸»ä½“ã€‚

```json
az ad sp create-for-rbac
   --name <NAME OF THE CREDENTIAL> --role contributor --scopes /subscriptions/<SUBSCRIPTION ID>/resourceGroups/<RESOURCE GROUP> --sdk-auth --output json
```

1. å¤åˆ¶å‘½ä»¤çš„JSONè¾“å‡ºã€‚
2. åœ¨GitHubå­˜å‚¨åº“ä¸­ï¼Œå¯¼èˆªåˆ°â€œè®¾ç½®â€>â€œæœºå¯†â€>â€œæ“ä½œâ€ï¼Œç„¶åé€‰æ‹©â€œæ–°å­˜å‚¨åº“æœºå¯†â€ã€‚
3. å°†â€œAZURE\_CREDENTIALSâ€è¾“å…¥ä¸ºåç§°ï¼Œå¹¶å°†JSONè¾“å‡ºçš„å†…å®¹ç²˜è´´ä¸ºå€¼ã€‚
4. é€‰æ‹©â€œæ·»åŠ æœºå¯†â€ã€‚2.AZURE\_APP\_SERVICE\_NAME åœ¨ç›¸åŒçš„å­˜å‚¨åº“å¯†é’¥ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„å˜é‡AZURE\_APP\_SERVICE\_NAMEï¼Œä»¥éƒ¨ç½²åˆ°Azure Webåº”ç”¨ç¨‹åºã€‚è¯¥å¯†é’¥çš„å€¼æ˜¯æ‚¨çš„Azure Webåº”ç”¨ç¨‹åºçš„åç§°ï¼Œä¾‹å¦‚ä»[https://my-web-app-name.azurewebsites.net/](https://my-web-app-name.azurewebsites.net/)åŸŸä¸­çš„my-web-app-nameã€‚

#### ğŸ”„ è¿è¡ŒGitHub Actions

ä¸€æ—¦é…ç½®äº†å¯†é’¥ï¼ŒGitHub Actionså°†åœ¨æ¯æ¬¡ä»£ç æ¨é€åˆ°å­˜å‚¨åº“æ—¶è§¦å‘ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨GitHubçš„Actionsé€‰é¡¹å¡ä¸­ç‚¹å‡»"Run Workflow"æŒ‰é’®æ¥æ‰‹åŠ¨è¿è¡Œå·¥ä½œæµã€‚ !\[ä¸‹è½½å¤±è´¥]\(./å¾®è½¯å‘å¸ƒAzure ChatGPTï¼šé€‚ç”¨ä¼ä¸šå†…ä½¿ç”¨çš„ç§æœ‰å’Œå®‰å…¨ ChatGPT.assert/runworkflow.png)

#### ğŸªª æ·»åŠ èº«ä»½æä¾›è€…

å®Œæˆéƒ¨ç½²åï¼Œæ‚¨éœ€è¦æ·»åŠ ä¸€ä¸ªèº«ä»½æä¾›è€…æ¥å¯¹æ‚¨çš„åº”ç”¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ â€‹ âš ï¸ æ³¨æ„ï¼šä¸‹é¢åªéœ€è¦ä¸€ä¸ªèº«ä»½æä¾›è€…ã€‚

#### GitHubèº«ä»½éªŒè¯æä¾›è€…

æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªGitHubåº”ç”¨ç¨‹åºï¼šä¸€ä¸ªç”¨äºæœ¬åœ°æµ‹è¯•ï¼Œå¦ä¸€ä¸ªç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ â€‹

#### ğŸŸ¡ å¼€å‘åº”ç”¨ç¨‹åºè®¾ç½®

1. å‰å¾€GitHub OAuthåº”ç”¨ç¨‹åºè®¾ç½®é¡µé¢ [https://github.com/settings/developers](https://github.com/settings/developers)
2. åˆ›å»ºä¸€ä¸ªæ–°çš„OAuthåº”ç”¨ç¨‹åº [https://github.com/settings/applications/new](https://github.com/settings/applications/new)
3. å¡«å†™ä»¥ä¸‹ç»†èŠ‚

```json
Application name: Azure ChatGPT DEV Environment
Homepage URL: http://localhost:3000
Authorization callback URL: http://localhost:3000/api/auth/callback/github
```

#### ğŸŸ¢ ç”Ÿäº§åº”ç”¨ç¨‹åºè®¾ç½®

1. è½¬åˆ°GitHub OAuth åº”ç”¨ç¨‹åºè®¾ç½® [https://github.com/settings/developers](https://github.com/settings/developers)
2. åˆ›å»ºä¸€ä¸ªæ–°çš„OAuth åº”ç”¨ç¨‹åº [https://github.com/settings/applications/new](https://github.com/settings/applications/new)
3. å¡«å†™ä»¥ä¸‹è¯¦ç»†ä¿¡æ¯

```json
Application name: Azure ChatGPT Production
Homepage URL: https://YOUR-WEBSITE-NAME.azurewebsites.net
Authorization callback URL: https://YOUR-WEBSITE-NAME.azurewebsites.net/api/auth/callback/github
```

âš ï¸ å®Œæˆåº”ç”¨ç¨‹åºè®¾ç½®åï¼Œè¯·ç¡®ä¿æœ¬åœ°å’ŒAzureåº”ç”¨æœåŠ¡ä¸Šçš„ç¯å¢ƒå˜é‡å·²ç»æ›´æ–°ã€‚

```json
# Azure AD OAuth app configuration

AZURE_AD_CLIENT_ID=
AZURE_AD_CLIENT_SECRET=
AZURE_AD_TENANT_ID=
```

### ğŸ”‘ ç¯å¢ƒå˜é‡

ä»¥ä¸‹æ˜¯æ‰€éœ€çš„ç¯å¢ƒå˜é‡ï¼Œéœ€è¦æ·»åŠ åˆ°Azure Portalæˆ–.env.localæ–‡ä»¶ä¸­ã€‚

| App Setting                          | Value              | Note                                                                                                                                   |
| ------------------------------------ | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------- |
| AZURE\_OPENAI\_API\_KEY              |                    | Azure OpenAIèµ„æºçš„APIå¯†é’¥                                                                                                                   |
| AZURE\_OPENAI\_API\_INSTANCE\_NAME   |                    | Azure OpenAIèµ„æºçš„åç§°ã€‚                                                                                                                     |
| AZURE\_OPENAI\_API\_DEPLOYMENT\_NAME |                    | The name of your model deployment                                                                                                      |
| AZURE\_OPENAI\_API\_VERSION          | 2023-03-15-preview | API version when using gpt chat                                                                                                        |
| AUTH\_GITHUB\_ID                     |                    | Client ID of your GitHub OAuth application                                                                                             |
| AUTH\_GITHUB\_SECRET                 |                    | Client Secret of your GitHub OAuth application                                                                                         |
| NEXTAUTH\_SECRET                     |                    | Used to encrypt the NextAuth.js JWT, and to hash email verification tokens. **This set by default as part of the deployment template** |
| NEXTAUTH\_URL                        |                    | Current webs hosting domain name with HTTP or HTTPS. **This set by default as part of the deployment template**                        |
| AZURE\_COSMOSDB\_URI                 |                    | URL of the Azure CosmosDB                                                                                                              |
| AZURE\_COSMOSDB\_KEY                 |                    | API Key for Azure Cosmos DB                                                                                                            |
| AZURE\_AD\_CLIENT\_ID                |                    | The client id specific to the application                                                                                              |
| AZURE\_AD\_CLIENT\_SECRET            |                    | The client secret specific to the application                                                                                          |
| AZURE\_AD\_TENANT\_ID                |                    | The organisation Tenant ID                                                                                                             |
